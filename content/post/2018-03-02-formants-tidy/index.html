---
title: Vowel formants trajectories and tidy data
author: Stefano Coretta
date: '2018-03-02'
slug: formants-tidy
categories:
  - Linguistics
tags:
  - rstats
  - tidy data
  - phonetics
  - phonology
  - linguistics
  - data processing
  - time series
  - formants
  - formant trajectories
  - ggplot2
bibliography: /Users/ste/texmf/bibtex/bib/linguistics.bib
cls: unified-style-sheet-for-linguistics.csl
---



<p>With the advent of more powerful statistical methods for assessing time series data, it is now becoming more common to compare whole vowel formant trajectories rather then just using average values.</p>
<p>In this post I will show how to tidy a formant measurements dataset and plot formants using the tidyverse <span class="citation">(<a href="#ref-wickham2017" role="doc-biblioref">Wickham 2017</a>)</span>.</p>
<div id="from-wide-to-long" class="section level1">
<h1>From wide to long</h1>
<p>To illustrate the process, I will use formant data that was kindly provided by <a href="http://tiny.cc/sjn">Stephen Nichols</a>.</p>
<p>Let’s first read in the data.</p>
<pre class="r"><code>trajectories &lt;- read_csv(&quot;./static/data/nichols-2018/tulemupepelako.csv&quot;)</code></pre>
<pre><code>## Rows: 7 Columns: 61
## ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (2): Vowel, Word
## dbl (59): Time, Duration, F1_05, F1_10, F1_15, F1_20, F1_25, F1_30, F1_35, F...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>trajectories</code></pre>
<pre><code>## # A tibble: 7 × 61
##    Time Vowel Word      Duration F1_05 F1_10 F1_15 F1_20 F1_25 F1_30 F1_35 F1_40
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  194. u     tulemupe…     43.3  406.  439.  453.  456.  430.  357.  314.  288.
## 2  194. e     tulemupe…    103.   503.  517.  537.  564.  556.  362.  315.  295.
## 3  194. u     tulemupe…     14.1  290.  288.  286.  283.  281.  281.  282.  295.
## 4  194. e     tulemupe…     75.7  440.  441.  439.  429.  386.  269.  250.  318.
## 5  194. e     tulemupe…     68.2  437.  445.  479.  562.  622.  605.  523.  618.
## 6  195. a     tulemupe…     89.8  800.  736.  662.  543.  447.  564.  768.  358.
## 7  195. o     tulemupe…     98.5  482.  463.  471.  326.  316.  573. 1511. 1389.
## # … with 49 more variables: F1_45 &lt;dbl&gt;, F1_50 &lt;dbl&gt;, F1_55 &lt;dbl&gt;, F1_60 &lt;dbl&gt;,
## #   F1_65 &lt;dbl&gt;, F1_70 &lt;dbl&gt;, F1_75 &lt;dbl&gt;, F1_80 &lt;dbl&gt;, F1_85 &lt;dbl&gt;,
## #   F1_90 &lt;dbl&gt;, F1_95 &lt;dbl&gt;, F2_05 &lt;dbl&gt;, F2_10 &lt;dbl&gt;, F2_15 &lt;dbl&gt;,
## #   F2_20 &lt;dbl&gt;, F2_25 &lt;dbl&gt;, F2_30 &lt;dbl&gt;, F2_35 &lt;dbl&gt;, F2_40 &lt;dbl&gt;,
## #   F2_45 &lt;dbl&gt;, F2_50 &lt;dbl&gt;, F2_55 &lt;dbl&gt;, F2_60 &lt;dbl&gt;, F2_65 &lt;dbl&gt;,
## #   F2_70 &lt;dbl&gt;, F2_75 &lt;dbl&gt;, F2_80 &lt;dbl&gt;, F2_85 &lt;dbl&gt;, F2_90 &lt;dbl&gt;,
## #   F2_95 &lt;dbl&gt;, F3_05 &lt;dbl&gt;, F3_10 &lt;dbl&gt;, F3_15 &lt;dbl&gt;, F3_20 &lt;dbl&gt;, …</code></pre>
<p>The dataset contains formant values of F1-F3 at 5% intervals for the vowels in the word <em>tulemupepelako</em> ‘we are praying for her’ (Bemba, [<code>bemb1257</code>]).</p>
<p>In the first step, we will create two columns, one with the formant/interval label and one with the formant value, using <code>pivot_longer()</code>.</p>
<pre class="r"><code>trajectories_long &lt;- pivot_longer(
  trajectories,
  F1_05:F3_95,
  names_to = &quot;formant_int&quot;,
  values_to = &quot;value&quot;)

trajectories_long</code></pre>
<pre><code>## # A tibble: 399 × 6
##     Time Vowel Word           Duration formant_int value
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;
##  1  194. u     tulemupepelako     43.3 F1_05        406.
##  2  194. u     tulemupepelako     43.3 F1_10        439.
##  3  194. u     tulemupepelako     43.3 F1_15        453.
##  4  194. u     tulemupepelako     43.3 F1_20        456.
##  5  194. u     tulemupepelako     43.3 F1_25        430.
##  6  194. u     tulemupepelako     43.3 F1_30        357.
##  7  194. u     tulemupepelako     43.3 F1_35        314.
##  8  194. u     tulemupepelako     43.3 F1_40        288.
##  9  194. u     tulemupepelako     43.3 F1_45        286.
## 10  194. u     tulemupepelako     43.3 F1_50        327.
## # … with 389 more rows</code></pre>
<p>The next step is to separate the <code>formant_int</code> column into two columns: one for <code>formant</code>, and one for <code>interval</code>.
The argument <code>convert = TRUE</code> ensures that the <code>interval</code> column is converted into a numeric column.</p>
<pre class="r"><code>trajectories_sep &lt;- separate(
  trajectories_long,
  formant_int,
  c(&quot;formant&quot;, &quot;interval&quot;),
  convert = TRUE
)

trajectories_sep</code></pre>
<pre><code>## # A tibble: 399 × 7
##     Time Vowel Word           Duration formant interval value
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt;
##  1  194. u     tulemupepelako     43.3 F1             5  406.
##  2  194. u     tulemupepelako     43.3 F1            10  439.
##  3  194. u     tulemupepelako     43.3 F1            15  453.
##  4  194. u     tulemupepelako     43.3 F1            20  456.
##  5  194. u     tulemupepelako     43.3 F1            25  430.
##  6  194. u     tulemupepelako     43.3 F1            30  357.
##  7  194. u     tulemupepelako     43.3 F1            35  314.
##  8  194. u     tulemupepelako     43.3 F1            40  288.
##  9  194. u     tulemupepelako     43.3 F1            45  286.
## 10  194. u     tulemupepelako     43.3 F1            50  327.
## # … with 389 more rows</code></pre>
<p>Now we can put back the formant labels into one column each.
We can achieve this with <code>pivot_wider()</code>, the counterpart of <code>pivo_longer()</code>.</p>
<pre class="r"><code>trajectories_wide &lt;- pivot_wider(
  trajectories_sep,
  names_from = formant,
  values_from = value
)

trajectories_wide</code></pre>
<pre><code>## # A tibble: 133 × 8
##     Time Vowel Word           Duration interval    F1    F2    F3
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;             &lt;dbl&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  194. u     tulemupepelako     43.3        5  406. 1205. 2626.
##  2  194. u     tulemupepelako     43.3       10  439. 1226. 2556.
##  3  194. u     tulemupepelako     43.3       15  453. 1246. 2507.
##  4  194. u     tulemupepelako     43.3       20  456. 1291. 2451.
##  5  194. u     tulemupepelako     43.3       25  430. 1418. 2331.
##  6  194. u     tulemupepelako     43.3       30  357. 1555. 2268.
##  7  194. u     tulemupepelako     43.3       35  314. 1603. 2335.
##  8  194. u     tulemupepelako     43.3       40  288. 1709. 2437.
##  9  194. u     tulemupepelako     43.3       45  286. 1712. 2461.
## 10  194. u     tulemupepelako     43.3       50  327. 1747. 2470.
## # … with 123 more rows</code></pre>
<p>We now have a dataset with separate columns for each formant and individual rows for each vowel interval.</p>
<div id="the-pipe" class="section level2">
<h2>The pipe</h2>
<p>All the individual steps above can be chained by using the pipe <code>%&gt;%</code>.
What the pipe does is simply “transferring” the output of the function before it as the input of the function after it.</p>
<pre class="r"><code>trajectories &lt;- trajectories %&gt;%
  pivot_longer(F1_05:F3_95, names_to = &quot;formant_int&quot;, values_to = &quot;value&quot;) %&gt;%
  separate(formant_int, c(&quot;formant&quot;, &quot;interval&quot;), convert = TRUE) %&gt;%
  pivot_wider(names_from = formant, values_from = value)</code></pre>
</div>
</div>
<div id="plot" class="section level1">
<h1>Plot</h1>
<p>We can finally plot the formant trajectories.</p>
<pre class="r"><code>trajectories %&gt;%
  ggplot(aes(x = interval)) +
  geom_smooth(aes(y = F1), method = &quot;gam&quot;, se = FALSE, colour = &quot;#A7473A&quot;) +
  geom_smooth(aes(y = F2), method = &quot;gam&quot;, se = FALSE, colour = &quot;#4B5F6C&quot;) +
  geom_smooth(aes(y = F3), method = &quot;gam&quot;, se = FALSE, colour = &quot;#B09B37&quot;) +
  facet_wrap(~ Vowel) +
  ylab(&quot;Hertz&quot;)</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;
## `geom_smooth()` using formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;
## `geom_smooth()` using formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/trajectory-plot-1.png" width="672" /></p>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-wickham2017" class="csl-entry">
Wickham, Hadley. 2017. <span>“<span class="nocase">t</span>idyverse: Easily Install and Load the Tidyverse.”</span> R package version 1.2.1.
</div>
</div>
</div>
</div>
