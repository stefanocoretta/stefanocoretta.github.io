---
title: Vowel formants trajectories and tidy data
author: Stefano Coretta
date: '2018-03-02'
slug: vowel-formants-trajectories-and-tidy-data
categories:
  - Linguistics
tags:
  - rstats
  - tidy data
  - phonetics
  - phonology
  - linguistics
  - data processing
  - time series
  - formants
  - formant trajectories
  - ggplot2
bibliography: /Users/stefano/repos/texmf/bibtex/bib/linguistics.bib
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>With the advent of more powerful statistical methods for accessing time series data, it is now more common to compare whole vowel formant trajectories rather then just using average formant values.</p>
<p>Sometimes, the output of the Praat script used for extracting formats data gives us a ‘wide format’ dataset.
In this format, separate columns contain formant values for each interval within the vowel.
Normally, values are extracted every 10% or 5% intervals within the vowel.</p>
<p>To work with formant trajectories data in <code>R</code>, we need instead a ‘long format’ dataset.
In a long format dataset, the percent intervals are layed out in rows, rather then columns.</p>
<p>We start by reading in the formant data, which were kindly provided by <a href="http://tiny.cc/sjn">Stephen Nichols</a>.</p>
<pre class="r"><code>trajectories &lt;- read_csv(&quot;./static/data/nichols-2018/tulemupepelako.csv&quot;)</code></pre>
<pre><code>## 
## ── Column specification ────────────────────────────────────────────────────────
## cols(
##   .default = col_double(),
##   Vowel = col_character(),
##   Word = col_character()
## )
## ℹ Use `spec()` for the full column specifications.</code></pre>
<pre class="r"><code>trajectories</code></pre>
<pre><code>## # A tibble: 7 x 61
##    Time Vowel Word  Duration F1_05 F1_10 F1_15 F1_20 F1_25 F1_30 F1_35 F1_40
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  194. u     tule…     43.3  406.  439.  453.  456.  430.  357.  314.  288.
## 2  194. e     tule…    103.   503.  517.  537.  564.  556.  362.  315.  295.
## 3  194. u     tule…     14.1  290.  288.  286.  283.  281.  281.  282.  295.
## 4  194. e     tule…     75.7  440.  441.  439.  429.  386.  269.  250.  318.
## 5  194. e     tule…     68.2  437.  445.  479.  562.  622.  605.  523.  618.
## 6  195. a     tule…     89.8  800.  736.  662.  543.  447.  564.  768.  358.
## 7  195. o     tule…     98.5  482.  463.  471.  326.  316.  573. 1511. 1389.
## # … with 49 more variables: F1_45 &lt;dbl&gt;, F1_50 &lt;dbl&gt;, F1_55 &lt;dbl&gt;, F1_60 &lt;dbl&gt;,
## #   F1_65 &lt;dbl&gt;, F1_70 &lt;dbl&gt;, F1_75 &lt;dbl&gt;, F1_80 &lt;dbl&gt;, F1_85 &lt;dbl&gt;,
## #   F1_90 &lt;dbl&gt;, F1_95 &lt;dbl&gt;, F2_05 &lt;dbl&gt;, F2_10 &lt;dbl&gt;, F2_15 &lt;dbl&gt;,
## #   F2_20 &lt;dbl&gt;, F2_25 &lt;dbl&gt;, F2_30 &lt;dbl&gt;, F2_35 &lt;dbl&gt;, F2_40 &lt;dbl&gt;,
## #   F2_45 &lt;dbl&gt;, F2_50 &lt;dbl&gt;, F2_55 &lt;dbl&gt;, F2_60 &lt;dbl&gt;, F2_65 &lt;dbl&gt;,
## #   F2_70 &lt;dbl&gt;, F2_75 &lt;dbl&gt;, F2_80 &lt;dbl&gt;, F2_85 &lt;dbl&gt;, F2_90 &lt;dbl&gt;,
## #   F2_95 &lt;dbl&gt;, F3_05 &lt;dbl&gt;, F3_10 &lt;dbl&gt;, F3_15 &lt;dbl&gt;, F3_20 &lt;dbl&gt;,
## #   F3_25 &lt;dbl&gt;, F3_30 &lt;dbl&gt;, F3_35 &lt;dbl&gt;, F3_40 &lt;dbl&gt;, F3_45 &lt;dbl&gt;,
## #   F3_50 &lt;dbl&gt;, F3_55 &lt;dbl&gt;, F3_60 &lt;dbl&gt;, F3_65 &lt;dbl&gt;, F3_70 &lt;dbl&gt;,
## #   F3_75 &lt;dbl&gt;, F3_80 &lt;dbl&gt;, F3_85 &lt;dbl&gt;, F3_90 &lt;dbl&gt;, F3_95 &lt;dbl&gt;</code></pre>
<p>The dataset contains formant values of F1-F3 at 5% intervals for the vowels of the word <em>tulemupepelako</em> ‘we are praying for her’ (Bemba, [<code>bemb1257</code>]).
It’s a toy dataset of course, just for purpose of illustration, so not very exciting!</p>
<p>The values for each 5% interval for each formant are in separate columns.
For plotting and modelling, though, we need the data to be in a ‘tidy’ format <span class="citation">(Wickham 2014)</span>:</p>
<ul>
<li>each observation unit is in a separate row</li>
<li>each variable is a separate column</li>
</ul>
<p>In our case, each observation unit is a 5% interval.
As for the variables, they are: time in the recording, word, vowel, vowel duration, F1, F2, and F3.</p>
<p>The first step towards a long format data set is to gather all the columns that have formant values to a column indicating the formant plus interval (like ‘F1_05’) and the value of that formant in that interval.
We can use <code>gather()</code> for this.</p>
<p>In the following chunks, I will illustrate the results of each step separately by saving the output of the functions to variables.
Later in this post, you’ll find a pipe chain with all functions without intermediate outputs.</p>
<pre class="r"><code>trajectories_gath &lt;- gather(trajectories, &quot;formant&quot;, &quot;value&quot;, F1_05:F3_95)
trajectories_gath</code></pre>
<pre><code>## # A tibble: 399 x 6
##     Time Vowel Word           Duration formant value
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1  194. u     tulemupepelako     43.3 F1_05    406.
##  2  194. e     tulemupepelako    103.  F1_05    503.
##  3  194. u     tulemupepelako     14.1 F1_05    290.
##  4  194. e     tulemupepelako     75.7 F1_05    440.
##  5  194. e     tulemupepelako     68.2 F1_05    437.
##  6  195. a     tulemupepelako     89.8 F1_05    800.
##  7  195. o     tulemupepelako     98.5 F1_05    482.
##  8  194. u     tulemupepelako     43.3 F1_10    439.
##  9  194. e     tulemupepelako    103.  F1_10    517.
## 10  194. u     tulemupepelako     14.1 F1_10    288.
## # … with 389 more rows</code></pre>
<p>Now we have a column <code>formant</code> with the formant plus interval label, and a column <code>value</code> with its value (in Hertz in our case).</p>
<p>The next step is to separate the label of the formant plus interval into two separate columns: one for <code>formant</code>, and one for <code>interval</code>.</p>
<pre class="r"><code>trajectories_sep &lt;- separate(trajectories_gath, formant, c(&quot;formant&quot;, &quot;interval&quot;), convert = TRUE)
trajectories_sep</code></pre>
<pre><code>## # A tibble: 399 x 7
##     Time Vowel Word           Duration formant interval value
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt;
##  1  194. u     tulemupepelako     43.3 F1             5  406.
##  2  194. e     tulemupepelako    103.  F1             5  503.
##  3  194. u     tulemupepelako     14.1 F1             5  290.
##  4  194. e     tulemupepelako     75.7 F1             5  440.
##  5  194. e     tulemupepelako     68.2 F1             5  437.
##  6  195. a     tulemupepelako     89.8 F1             5  800.
##  7  195. o     tulemupepelako     98.5 F1             5  482.
##  8  194. u     tulemupepelako     43.3 F1            10  439.
##  9  194. e     tulemupepelako    103.  F1            10  517.
## 10  194. u     tulemupepelako     14.1 F1            10  288.
## # … with 389 more rows</code></pre>
<p>Now we can create individual columns for each formant from F1 to F3.
We can achieve this with <code>spread()</code>.</p>
<pre class="r"><code>trajectories_spr &lt;- spread(trajectories_sep, formant, value)
trajectories_spr</code></pre>
<pre><code>## # A tibble: 133 x 8
##     Time Vowel Word           Duration interval    F1    F2    F3
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;             &lt;dbl&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  194. u     tulemupepelako     43.3        5  406. 1205. 2626.
##  2  194. u     tulemupepelako     43.3       10  439. 1226. 2556.
##  3  194. u     tulemupepelako     43.3       15  453. 1246. 2507.
##  4  194. u     tulemupepelako     43.3       20  456. 1291. 2451.
##  5  194. u     tulemupepelako     43.3       25  430. 1418. 2331.
##  6  194. u     tulemupepelako     43.3       30  357. 1555. 2268.
##  7  194. u     tulemupepelako     43.3       35  314. 1603. 2335.
##  8  194. u     tulemupepelako     43.3       40  288. 1709. 2437.
##  9  194. u     tulemupepelako     43.3       45  286. 1712. 2461.
## 10  194. u     tulemupepelako     43.3       50  327. 1747. 2470.
## # … with 123 more rows</code></pre>
<p>What we have now is a long format dataset, with separate columns for each formant, and individual rows for each vowel interval.</p>
<div id="the-pipe-chain" class="section level2">
<h2>The pipe chain</h2>
<p>All the steps above can be chained by using the pipe <code>%&gt;%</code>.</p>
<pre class="r"><code>trajectories &lt;- trajectories %&gt;%
  gather(&quot;formant&quot;, &quot;value&quot;, F1_05:F3_95) %&gt;%
  separate(formant, c(&quot;formant&quot;, &quot;interval&quot;), convert = TRUE) %&gt;%
  spread(formant, value)</code></pre>
<p>We can finally easily plot the formant trajectories.</p>
<pre class="r"><code>trajectories %&gt;%
  ggplot(aes(x = interval)) +
  geom_smooth(aes(y = F1), se = FALSE, colour = &quot;red&quot;) +
  geom_smooth(aes(y = F2), se = FALSE, colour = &quot;green&quot;) +
  geom_smooth(aes(y = F3), se = FALSE, colour = &quot;blue&quot;) +
  facet_wrap(~ Vowel) +
  ylab(&quot;Hertz&quot;)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/post/2018-03-02-vowel-formants-trajectories-and-tidy-data_files/figure-html/trajectory-plot-1.png" width="672" /></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-wickham2014" class="csl-entry">
<p>Wickham, Hadley. 2014. <span>“Tidy Data.”</span> <em>Journal of Statistical Software</em> 59 (10): 1–23.</p>
</div>
</div>
</div>
