---
title: Plotting tongue contours with ggplot2
author: Stefano Coretta
date: '2018-08-23'
slug: tongue-ggplot2
categories:
  - Linguistics
tags:
  - rstats
  - phonetics
  - phonology
  - data viz
  - uti
  - ultrasound
  - tongue contours
---



<p>When plotting tongue contours data obtained from ultrasound tongue imaging in <code>R</code> using <code>ggplot2</code>, a common option to smooth over the individual contours and show the general pattern is to use <code>geom_smooth(methood = "loess")</code>. However, as I will show in this post, in certain cases this method leads to very disorted contours. Such distortion is more or less always present, although at a lower degree in less extreme cases.</p>
<p>To show the shortcomings of using <code>geom_smooth()</code> and present a viable alternative, we’ll be using ultrasound tongue imaging data from one speaker (me). This dataset includes tongue contours from within the closure of the conosonants /t, d/ preceeded by /a, o, u/. The dataset looks like this (some columns dropped):</p>
<pre class="r"><code>select(tongue_data, rec_date, fan_line, X, Y, word, vowel, c2)</code></pre>
<pre><code>## # A tibble: 1,239 × 7
##    rec_date            fan_line     X     Y word  vowel c2   
##    &lt;chr&gt;                  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
##  1 29/11/2016 15:10:52        6  37.4  9.25 pada  a     d    
##  2 29/11/2016 15:21:30        6  38.6 13.1  pada  a     d    
##  3 29/11/2016 15:10:52        7  34.4 10.3  pada  a     d    
##  4 29/11/2016 15:11:03        7  34.3  9.81 pata  a     t    
##  5 29/11/2016 15:11:14        7  34.6 11.0  podo  o     d    
##  6 29/11/2016 15:13:39        7  34.3  9.65 pada  a     d    
##  7 29/11/2016 15:16:05        7  34.8 11.5  pada  a     d    
##  8 29/11/2016 15:17:07        7  34.5 10.5  putu  u     t    
##  9 29/11/2016 15:19:45        7  34.3  9.64 putu  u     t    
## 10 29/11/2016 15:21:30        7  35.4 13.8  pada  a     d    
## # … with 1,229 more rows</code></pre>
<p><code>rec_date</code> is the date and time of recording. Each observed tongue contour has a unique <code>rec_date</code> (this will come in handy later). <code>fan_line</code> is the number of the line in the fan coordinate system used by Articulate Assistant Advanced (which I used to record the data). <code>X</code> and <code>Y</code> are the horizontal and vertical position of each point on the contour. The unit is millimeters. <code>word</code>, <code>vowel</code> and <code>c2</code> are self-explanatory.</p>
<p>Let’s start by plotting the smoothed contours by vowel and consonant.</p>
<pre class="r"><code>tongue_data %&gt;%
  ggplot(aes(X, Y)) +
  geom_smooth(aes(colour = vowel), method = &quot;loess&quot;) +
  coord_fixed() +
  facet_grid(c2 ~ vowel) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/smooth-1.png" width="672" /></p>
<p>We can immediately notice that with /u/ there is something odd going on. That does not look like a tongue surface (maybe that of a chameleon! Definitely not one of a ‘hooman’.) The smooths for /a/ and /o/ seem quite standard.</p>
<p>To see what is going on, let’s plot now also the individual points as recorded in the data, whith a superimoposed smooth, for comparison.</p>
<pre class="r"><code>tongue_data %&gt;%
  ggplot(aes(X, Y)) +
  geom_point(alpha = 0.1) +
  geom_smooth(aes(colour = vowel), method = &quot;loess&quot;) +
  coord_fixed() +
  facet_grid(c2 ~ vowel) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/points-1.png" width="672" /></p>
<p>While the smooths with /a/ and /o/ more or less have a good fit when compared to the points, with /u/ the smooths are really off.</p>
<p>This happpens because the tongue root (in this particular case) developpes vertically rather than slanted. The smooth isagnostic about the fact that points lying on the same X value but with different Y values belong to different portion of the tongue contour. The result is that smoothing happens across tongue parts.</p>
<p>An alternative (if you don’t like points) is to use <code>geom_path()</code> to plot the individual tongue contours as lines. <code>geom_path()</code> connects points with a line, following the order in which they appear in the dataset. So, before using this geometry, we need to arrange the dataframe such that the points are in the right order (now they are in the wrong order).</p>
<p>To do so, we can use <code>rec_date</code> (which identifies the individual contours) and <code>fan_line</code> which indicates the orders of points (for each contour, there a maximum 42 points/fan lines; NAs have been excluded).</p>
<pre class="r"><code>tongue_data &lt;- tongue_data %&gt;%
  arrange(rec_date, fan_line)

tongue_data</code></pre>
<pre><code>## # A tibble: 1,239 × 30
##    speaker seconds rec_date            prompt label TT_displacement… TT_velocity
##    &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;               &lt;chr&gt;  &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;
##  1 it01       1.11 29/11/2016 15:10:52 Dico … max_…             77.4       -7.18
##  2 it01       1.11 29/11/2016 15:10:52 Dico … max_…             77.4       -7.18
##  3 it01       1.11 29/11/2016 15:10:52 Dico … max_…             77.4       -7.18
##  4 it01       1.11 29/11/2016 15:10:52 Dico … max_…             77.4       -7.18
##  5 it01       1.11 29/11/2016 15:10:52 Dico … max_…             77.4       -7.18
##  6 it01       1.11 29/11/2016 15:10:52 Dico … max_…             77.4       -7.18
##  7 it01       1.11 29/11/2016 15:10:52 Dico … max_…             77.4       -7.18
##  8 it01       1.11 29/11/2016 15:10:52 Dico … max_…             77.4       -7.18
##  9 it01       1.11 29/11/2016 15:10:52 Dico … max_…             77.4       -7.18
## 10 it01       1.11 29/11/2016 15:10:52 Dico … max_…             77.4       -7.18
## # … with 1,229 more rows, and 23 more variables: TT_velocity_abs &lt;dbl&gt;,
## #   TD_displacement_sm &lt;dbl&gt;, TD_velocity &lt;dbl&gt;, TD_velocity_abs &lt;dbl&gt;,
## #   TR_displacement_sm &lt;dbl&gt;, TR_velocity &lt;dbl&gt;, TR_velocity_abs &lt;dbl&gt;,
## #   fan_line &lt;int&gt;, X &lt;dbl&gt;, Y &lt;dbl&gt;, word &lt;chr&gt;, language &lt;chr&gt;, sex &lt;chr&gt;,
## #   item &lt;int&gt;, ipa &lt;chr&gt;, c1 &lt;chr&gt;, c1_phonation &lt;chr&gt;, vowel &lt;chr&gt;,
## #   anteropost &lt;chr&gt;, height &lt;chr&gt;, c2 &lt;chr&gt;, c2_phonation &lt;chr&gt;,
## #   c2_place &lt;chr&gt;</code></pre>
<p>We can now use <code>geom_path()</code>. The argument <code>group = rec_date</code> ensures that individual lines are plotted (without it, the last point of one contour is connected with the first of the contour following in the dataset).</p>
<pre class="r"><code>tongue_data %&gt;%
  ggplot(aes(X, Y)) +
  geom_path(aes(group = rec_date, colour = vowel), alpha = 0.5) +
  coord_fixed() +
  facet_grid(c2 ~ vowel) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/path-1.png" width="672" /></p>
<p>The tongue root in /u/ is now properly rendered.</p>
<p>But what fif you want to plot a single contour (possibly with confidence intervals) for each of the 6 panels in the previous figure, rather than all the contours?</p>
<p>An option is to plot an average contour (litterally, the aveages of X and Y). We can easily do that by grouping the data by <code>fan_line</code> and then <code>summarise()</code> it. Plotting can then be done with <code>geom_path()</code> and <code>geom_polygon()</code>. All together, the code looks like this.</p>
<pre class="r"><code>xy_mean &lt;- tongue_data %&gt;%
  group_by(fan_line, vowel, c2) %&gt;%
  summarise(
    X_mean = mean(X, na.rm = TRUE),
    Y_mean = mean(Y, na.rm = TRUE)
  )</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;fan_line&#39;, &#39;vowel&#39;. You can override using the `.groups` argument.</code></pre>
<pre class="r"><code>xy_ci &lt;- tongue_data %&gt;%
  group_by(fan_line, vowel, c2) %&gt;%
  summarise(
    X_CI_low = t.test(X)$conf.int[1],
    X_CI_up = t.test(X)$conf.int[2],
    Y_CI_low = t.test(Y)$conf.int[1],
    Y_CI_up = t.test(Y)$conf.int[2]
  )</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;fan_line&#39;, &#39;vowel&#39;. You can override using the `.groups` argument.</code></pre>
<pre class="r"><code>ci_upper &lt;- xy_ci %&gt;%
  dplyr::select(-X_CI_low, -Y_CI_low) %&gt;%
  dplyr::rename(
    CI_X = X_CI_up,
    CI_Y = Y_CI_up
  )

ci_lower &lt;- xy_ci %&gt;%
  dplyr::select(-X_CI_up, -Y_CI_up) %&gt;%
  dplyr::arrange(dplyr::desc(fan_line)) %&gt;%
  dplyr::rename(
    CI_X = X_CI_low,
    CI_Y = Y_CI_low
  )

ci &lt;- rbind(ci_upper, ci_lower)

ggplot(xy_mean, aes(X_mean, Y_mean)) +
  geom_polygon(data = ci, aes(x = CI_X, y = CI_Y), alpha = 0.2) +
  geom_path(aes(X_mean, Y_mean, colour = vowel)) +
  facet_grid(c2 ~ vowel) +
  coord_fixed() +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/mean-path-1.png" width="672" /></p>
