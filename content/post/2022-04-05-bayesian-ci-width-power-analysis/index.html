---
title: Bayesian CrI-width power analysis
author: Stefano Coretta
date: '2022-04-05'
slug: []
categories: []
tags: []
math: true
---



<p>This post shows how to do a quick and dirty Bayesian power analysis.</p>
<p>‚ÄúPower‚Äù analysis might not be a very appropriate term when Bayesian statistics is concerned.
A good alternative could be ‚Äúprecision‚Äù analysis, since the method presented in this post is about estimate precision.</p>
<p>More specifically, the aim of this type of analysis is to <strong>find the approximate minimum sample size required to reach a given level of precision</strong>.
By precision, I mean the width of the posterior probability of the effect of interest and, by corollary, the widths of its Credible Intervals (CrI).
The smaller the width of posterior/CrI, the greater the precision of the estimate.</p>
<p>To calculate the minimum sample size for a particular precision value, we can take advantage of the formula of the standard error of the mean:</p>
<p><span class="math display">\[
se = \frac{\sigma}{\sqrt{n}}
\]</span></p>
<p>where <span class="math inline">\(se\)</span> is the standard error of the mean, <span class="math inline">\(\sigma\)</span> is the sample standard deviation and <span class="math inline">\(n\)</span> is the sample size.</p>
<p>Note that in Bayesian statistics, the <span class="math inline">\(se\)</span> is the standard deviation of the posterior probability of the effect of interest.</p>
<p>In the scenario of a power analysis, we want to know which <span class="math inline">\(n_e\)</span> we need to get a specific <span class="math inline">\(se_e\)</span>.
We can calculate the expected sample size <span class="math inline">\(n_e\)</span> to get a specific <span class="math inline">\(se_e\)</span> by plugging in the observed <span class="math inline">\(se_o\)</span>, the known sample size <span class="math inline">\(n_o\)</span> and the chosen <span class="math inline">\(se_e\)</span>, in the following formula (which is derived from the standard error formula above).</p>
<p><span class="math display">\[
n_e = \left( \frac{\sqrt{n_o} \times se_o}{se_e}\right)^2
\]</span></p>
<p>Let‚Äôs see how to calculate <span class="math inline">\(n_e\)</span>.</p>
<p>Imagine you have fitted a Bayesian linear model to f0 values with formality as a predictor (formal vs informal speech).
Let‚Äôs say the posterior probability of the effect of formality has a 95% CrI = [-10, +30] Hz, meaning that the standard deviation is 10 Hz.
In total, there were 150 data points.</p>
<p>So, the observed standard error (i.e.¬†the standard deviation of the posterior) is <span class="math inline">\(se_o = 10\)</span>, the sample size is <span class="math inline">\(n_o = 150\)</span>.</p>
<p>Then we need to choose the standard error <span class="math inline">\(se_e\)</span> we would want to be able to get if we ran a second iteration of the study.
Let‚Äôs say we want an <span class="math inline">\(se_e\)</span> of 5 Hz.
Now, which is the <span class="math inline">\(n_e\)</span> we need to get <span class="math inline">\(se_e = 5\)</span>?</p>
<p>Easy! We just plug in the numbers to get <span class="math inline">\(n_e\)</span>.</p>
<pre class="r"><code>n_o &lt;- 150
se_o &lt;- 10
se_e &lt;- 5

n_e &lt;- ( ( sqrt(n_o) * se_o ) / se_e )^2
n_e</code></pre>
<pre><code>## [1] 600</code></pre>
<p>The sample size required to go from an <span class="math inline">\(se_o\)</span> of 10 Hz to an <span class="math inline">\(se_e\)</span> of 4 Hz is 600. üò±</p>
<p>So to get an <span class="math inline">\(se\)</span> that is half of the observed one we would need 4 times the number of data points.</p>
<div id="functions-ex-machina" class="section level1">
<h1>Functions ex machina</h1>
<p>Let‚Äôs spice our coding up a bit and write a few functions we can use to calculate samples sizes for different &amp;se_e$s.</p>
<p>Also, so far we‚Äôve been talking about <span class="math inline">\(se_e\)</span> or, in other words, the standard deviation of the of the posterior probability of the effect of interest.
If you remember your probability 101, you should know that the width of the 95% CrI of a posterior probability is 4 times the standard deviation.</p>
<p>So let‚Äôs write a function to calculate <span class="math inline">\(n_e\)</span> based on the <em>width</em> of the 95% CrI, rather than on the <span class="math inline">\(se_e\)</span>.</p>
<pre class="r"><code>estimate_n &lt;- function(obs_se, obs_n, width, divide = 1) {
  sigma &lt;- sqrt(obs_n) * obs_se
  se &lt;- width / 4
  new_n &lt;- (sigma / se)^2
  return(new_n / divide)
}</code></pre>
<p>Let‚Äôs take it for a spin, using the numbers from the example above.
The <span class="math inline">\(se_o\)</span> we observed was 10 Hz, that‚Äôs corresponds to a width of <span class="math inline">\(10 * 4 = 40\)</span> Hz.
(Note that the first argument is the <span class="math inline">\(se_o\)</span>, not the width, but you can change that for consistency if you wish).
The sample size <span class="math inline">\(n_o\)</span> was 150.
The <span class="math inline">\(se_e\)</span> we want was 5 Hz, so the width is <span class="math inline">\(5 * 4 = 20\)</span> Hz.</p>
<p>Let‚Äôs plug in these numbers.</p>
<pre class="r"><code>estimate_n(obs_se = 10, obs_n = 150, width = 20)</code></pre>
<pre><code>## [1] 600</code></pre>
<p>As we have already seen above, to get a 95% CrI width of 20 Hz, we would need at least 600 observations.</p>
<p>Now let‚Äôs define a few functions that calculate the required sample size at different widths and create a plot.</p>
<pre class="r"><code>get_obs_range &lt;- function(obs_se, obs_n, min_width = 1, max_width, by = 1, divide = 1) {
  obs_range &lt;- NULL
  for (i in seq(min_width, max_width, by = by)) {
    obs_range &lt;- c(obs_range, estimate_n(obs_se, obs_n, i, divide))
  }
  return(obs_range)
}

plot_obs_range &lt;- function(obs_se, obs_n, min_width = 1, max_width, by = 1, divide = 1) {
  obs_range &lt;- get_obs_range(obs_se, obs_n, min_width, max_width, by, divide)

  ggplot2::ggplot() +
    aes(x = seq(min_width, max_width, by = by), y = obs_range) +
    geom_point() +
    geom_path() +
    labs(
      caption = paste0(&quot;SE = &quot;, obs_se, &quot;, &quot;, obs_n, &quot; obs&quot;),
      x = &quot;CI width&quot;,
      y = paste0(&quot;Estimated N &quot;, &quot;(N/&quot;, divide, &quot;)&quot;)
    )
}</code></pre>
<p>Let‚Äôs now plot the required sample sizes to reach a 95% CrI width in the range from 10 to 50, by 5.</p>
<pre class="r"><code>plot_obs_range(10, 150, min_width = 10, max_width = 50, by = 5) +
  scale_y_continuous(breaks = seq(0, 3000, 250))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/rr,%20eval-1.png" width="672" /></p>
</div>
