<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Bayesian CrI-width power analysis | Stefano Coretta</title>

<meta name="keywords" content="" />
<meta name="description" content="This post shows how to do a quick and dirty Bayesian power analysis.
‚ÄúPower‚Äù analysis might not be a very appropriate term when Bayesian statistics is concerned. A good alternative could be ‚Äúprecision‚Äù analysis, since the method presented in this post is about estimate precision.
More specifically, the aim of this type of analysis is to find the approximate minimum sample size required to reach a given level of precision.">
<meta name="author" content="Stefano Coretta">
<link rel="canonical" href="https://stefanocoretta.github.io/post/2022-04-05-bayesian-ci-width-power-analysis/" />
<link href="/assets/css/stylesheet.min.a31c75ee58abbdfa57a7c3ce443a8651fe82bb20fcdb7c710d6200a7094b5ce4.css" integrity="sha256-oxx17lirvfpXp8PORDqGUf6CuyD823xxDWIApwlLXOQ=" rel="preload stylesheet"
    as="style">

<link rel="icon" href="https://stefanocoretta.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://stefanocoretta.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://stefanocoretta.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://stefanocoretta.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://stefanocoretta.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.110.0">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>



<script src="https://kit.fontawesome.com/0019a3da9c.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">


<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Alegreya+Sans+SC:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">


<link rel="stylesheet" href="/leaflet/leaflet.css"/>
<script src="/leaflet/leaflet.js"></script>
<link rel="stylesheet" href="/Leaflet.awesome-markers-2.0-develop/dist/leaflet.awesome-markers.css">
<script src="/Leaflet.awesome-markers-2.0-develop/dist/leaflet.awesome-markers.js"></script>
<meta property="og:title" content="Bayesian CrI-width power analysis" />
<meta property="og:description" content="This post shows how to do a quick and dirty Bayesian power analysis.
‚ÄúPower‚Äù analysis might not be a very appropriate term when Bayesian statistics is concerned. A good alternative could be ‚Äúprecision‚Äù analysis, since the method presented in this post is about estimate precision.
More specifically, the aim of this type of analysis is to find the approximate minimum sample size required to reach a given level of precision." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://stefanocoretta.github.io/post/2022-04-05-bayesian-ci-width-power-analysis/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-04-05T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2022-04-05T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Bayesian CrI-width power analysis"/>
<meta name="twitter:description" content="This post shows how to do a quick and dirty Bayesian power analysis.
‚ÄúPower‚Äù analysis might not be a very appropriate term when Bayesian statistics is concerned. A good alternative could be ‚Äúprecision‚Äù analysis, since the method presented in this post is about estimate precision.
More specifically, the aim of this type of analysis is to find the approximate minimum sample size required to reach a given level of precision."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://stefanocoretta.github.io/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Bayesian CrI-width power analysis",
      "item": "https://stefanocoretta.github.io/post/2022-04-05-bayesian-ci-width-power-analysis/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Bayesian CrI-width power analysis",
  "name": "Bayesian CrI-width power analysis",
  "description": "This post shows how to do a quick and dirty Bayesian power analysis.\n‚ÄúPower‚Äù analysis might not be a very appropriate term when Bayesian statistics is concerned. A good alternative could be ‚Äúprecision‚Äù analysis, since the method presented in this post is about estimate precision.\nMore specifically, the aim of this type of analysis is to find the approximate minimum sample size required to reach a given level of precision.",
  "keywords": [
    
  ],
  "articleBody": " This post shows how to do a quick and dirty Bayesian power analysis.\n‚ÄúPower‚Äù analysis might not be a very appropriate term when Bayesian statistics is concerned. A good alternative could be ‚Äúprecision‚Äù analysis, since the method presented in this post is about estimate precision.\nMore specifically, the aim of this type of analysis is to find the approximate minimum sample size required to reach a given level of precision. By precision, I mean the width of the posterior probability of the effect of interest and, by corollary, the widths of its Credible Intervals (CrI). The smaller the width of posterior/CrI, the greater the precision of the estimate.\nTo calculate the minimum sample size for a particular precision value, we can take advantage of the formula of the standard error of the mean:\n\\[ se = \\frac{\\sigma}{\\sqrt{n}} \\]\nwhere \\(se\\) is the standard error of the mean, \\(\\sigma\\) is the sample standard deviation and \\(n\\) is the sample size.\nNote that in Bayesian statistics, the \\(se\\) is the standard deviation of the posterior probability of the effect of interest.\nIn the scenario of a power analysis, we want to know which \\(n_e\\) we need to get a specific \\(se_e\\). We can calculate the expected sample size \\(n_e\\) to get a specific \\(se_e\\) by plugging in the observed \\(se_o\\), the known sample size \\(n_o\\) and the chosen \\(se_e\\), in the following formula (which is derived from the standard error formula above).\n\\[ n_e = \\left( \\frac{\\sqrt{n_o} \\times se_o}{se_e}\\right)^2 \\]\nLet‚Äôs see how to calculate \\(n_e\\).\nImagine you have fitted a Bayesian linear model to f0 values with formality as a predictor (formal vs informal speech). Let‚Äôs say the posterior probability of the effect of formality has a 95% CrI = [-10, +30] Hz, meaning that the standard deviation is 10 Hz. In total, there were 150 data points.\nSo, the observed standard error (i.e.¬†the standard deviation of the posterior) is \\(se_o = 10\\), the sample size is \\(n_o = 150\\).\nThen we need to choose the standard error \\(se_e\\) we would want to be able to get if we ran a second iteration of the study. Let‚Äôs say we want an \\(se_e\\) of 5 Hz. Now, which is the \\(n_e\\) we need to get \\(se_e = 5\\)?\nEasy! We just plug in the numbers to get \\(n_e\\).\nn_o \u003c- 150 se_o \u003c- 10 se_e \u003c- 5 n_e \u003c- ( ( sqrt(n_o) * se_o ) / se_e )^2 n_e ## [1] 600 The sample size required to go from an \\(se_o\\) of 10 Hz to an \\(se_e\\) of 4 Hz is 600. üò±\nSo to get an \\(se\\) that is half of the observed one we would need 4 times the number of data points.\nFunctions ex machina Let‚Äôs spice our coding up a bit and write a few functions we can use to calculate samples sizes for different \u0026se_e$s.\nAlso, so far we‚Äôve been talking about \\(se_e\\) or, in other words, the standard deviation of the of the posterior probability of the effect of interest. If you remember your probability 101, you should know that the width of the 95% CrI of a posterior probability is 4 times the standard deviation.\nSo let‚Äôs write a function to calculate \\(n_e\\) based on the width of the 95% CrI, rather than on the \\(se_e\\).\nestimate_n \u003c- function(obs_se, obs_n, width, divide = 1) { sigma \u003c- sqrt(obs_n) * obs_se se \u003c- width / 4 new_n \u003c- (sigma / se)^2 return(new_n / divide) } Let‚Äôs take it for a spin, using the numbers from the example above. The \\(se_o\\) we observed was 10 Hz, that‚Äôs corresponds to a width of \\(10 * 4 = 40\\) Hz. (Note that the first argument is the \\(se_o\\), not the width, but you can change that for consistency if you wish). The sample size \\(n_o\\) was 150. The \\(se_e\\) we want was 5 Hz, so the width is \\(5 * 4 = 20\\) Hz.\nLet‚Äôs plug in these numbers.\nestimate_n(obs_se = 10, obs_n = 150, width = 20) ## [1] 600 As we have already seen above, to get a 95% CrI width of 20 Hz, we would need at least 600 observations.\nNow let‚Äôs define a few functions that calculate the required sample size at different widths and create a plot.\nget_obs_range \u003c- function(obs_se, obs_n, min_width = 1, max_width, by = 1, divide = 1) { obs_range \u003c- NULL for (i in seq(min_width, max_width, by = by)) { obs_range \u003c- c(obs_range, estimate_n(obs_se, obs_n, i, divide)) } return(obs_range) } plot_obs_range \u003c- function(obs_se, obs_n, min_width = 1, max_width, by = 1, divide = 1) { obs_range \u003c- get_obs_range(obs_se, obs_n, min_width, max_width, by, divide) ggplot2::ggplot() + aes(x = seq(min_width, max_width, by = by), y = obs_range) + geom_point() + geom_path() + labs( caption = paste0(\"SE = \", obs_se, \", \", obs_n, \" obs\"), x = \"CI width\", y = paste0(\"Estimated N \", \"(N/\", divide, \")\") ) } Let‚Äôs now plot the required sample sizes to reach a 95% CrI width in the range from 10 to 50, by 5.\nplot_obs_range(10, 150, min_width = 10, max_width = 50, by = 5) + scale_y_continuous(breaks = seq(0, 3000, 250)) ",
  "wordCount" : "856",
  "inLanguage": "en",
  "datePublished": "2022-04-05T00:00:00Z",
  "dateModified": "2022-04-05T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Stefano Coretta"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://stefanocoretta.github.io/post/2022-04-05-bayesian-ci-width-power-analysis/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Stefano Coretta",
    "logo": {
      "@type": "ImageObject",
      "url": "https://stefanocoretta.github.io/favicon.ico"
    }
  }
}
</script>





</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }
    </style>

</noscript>
<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://stefanocoretta.github.io" accesskey="h" title="Stefano Coretta (Alt + H)">Stefano Coretta</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                
                
            </span>
        </div>
        <ul id="menu" onscroll="menu_on_scroll()">
            <li>
                <a href="https://stefanocoretta.github.io" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://stefanocoretta.github.io/research/" title="Research">
                    <span>Research</span>
                </a>
            </li>
            <li>
                <a href="https://stefanocoretta.github.io/teaching/" title="Teaching">
                    <span>Teaching</span>
                </a>
            </li>
            <li>
                <a href="https://stefanocoretta.github.io/meta/" title="Meta">
                    <span>Meta</span>
                </a>
            </li>
            <li>
                <a href="https://stefanocoretta.github.io/output/" title="Output">
                    <span>Output</span>
                </a>
            </li>
            <li>
                <a href="https://stefanocoretta.github.io/archives/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://stefanocoretta.github.io/docs/CorettaCV.pdf" title="CV">
                    <span>CV</span>
                </a>
            </li></ul>
    </nav>
</header>

    <main class="main">

<article class="post-single">
  <header class="post-header">

    <h1 class="post-title">
      Bayesian CrI-width power analysis
    </h1>
    <div class="post-meta">

April 5, 2022&nbsp;¬∑&nbsp;5 min&nbsp;¬∑&nbsp;Stefano Coretta


</div>
  </header> 

  <div class="post-content">



<p>This post shows how to do a quick and dirty Bayesian power analysis.</p>
<p>‚ÄúPower‚Äù analysis might not be a very appropriate term when Bayesian statistics is concerned.
A good alternative could be ‚Äúprecision‚Äù analysis, since the method presented in this post is about estimate precision.</p>
<p>More specifically, the aim of this type of analysis is to <strong>find the approximate minimum sample size required to reach a given level of precision</strong>.
By precision, I mean the width of the posterior probability of the effect of interest and, by corollary, the widths of its Credible Intervals (CrI).
The smaller the width of posterior/CrI, the greater the precision of the estimate.</p>
<p>To calculate the minimum sample size for a particular precision value, we can take advantage of the formula of the standard error of the mean:</p>
<p><span class="math display">\[
se = \frac{\sigma}{\sqrt{n}}
\]</span></p>
<p>where <span class="math inline">\(se\)</span> is the standard error of the mean, <span class="math inline">\(\sigma\)</span> is the sample standard deviation and <span class="math inline">\(n\)</span> is the sample size.</p>
<p>Note that in Bayesian statistics, the <span class="math inline">\(se\)</span> is the standard deviation of the posterior probability of the effect of interest.</p>
<p>In the scenario of a power analysis, we want to know which <span class="math inline">\(n_e\)</span> we need to get a specific <span class="math inline">\(se_e\)</span>.
We can calculate the expected sample size <span class="math inline">\(n_e\)</span> to get a specific <span class="math inline">\(se_e\)</span> by plugging in the observed <span class="math inline">\(se_o\)</span>, the known sample size <span class="math inline">\(n_o\)</span> and the chosen <span class="math inline">\(se_e\)</span>, in the following formula (which is derived from the standard error formula above).</p>
<p><span class="math display">\[
n_e = \left( \frac{\sqrt{n_o} \times se_o}{se_e}\right)^2
\]</span></p>
<p>Let‚Äôs see how to calculate <span class="math inline">\(n_e\)</span>.</p>
<p>Imagine you have fitted a Bayesian linear model to f0 values with formality as a predictor (formal vs informal speech).
Let‚Äôs say the posterior probability of the effect of formality has a 95% CrI = [-10, +30] Hz, meaning that the standard deviation is 10 Hz.
In total, there were 150 data points.</p>
<p>So, the observed standard error (i.e.¬†the standard deviation of the posterior) is <span class="math inline">\(se_o = 10\)</span>, the sample size is <span class="math inline">\(n_o = 150\)</span>.</p>
<p>Then we need to choose the standard error <span class="math inline">\(se_e\)</span> we would want to be able to get if we ran a second iteration of the study.
Let‚Äôs say we want an <span class="math inline">\(se_e\)</span> of 5 Hz.
Now, which is the <span class="math inline">\(n_e\)</span> we need to get <span class="math inline">\(se_e = 5\)</span>?</p>
<p>Easy! We just plug in the numbers to get <span class="math inline">\(n_e\)</span>.</p>
<pre class="r"><code>n_o &lt;- 150
se_o &lt;- 10
se_e &lt;- 5

n_e &lt;- ( ( sqrt(n_o) * se_o ) / se_e )^2
n_e</code></pre>
<pre><code>## [1] 600</code></pre>
<p>The sample size required to go from an <span class="math inline">\(se_o\)</span> of 10 Hz to an <span class="math inline">\(se_e\)</span> of 4 Hz is 600. üò±</p>
<p>So to get an <span class="math inline">\(se\)</span> that is half of the observed one we would need 4 times the number of data points.</p>
<div id="functions-ex-machina" class="section level1">
<h1>Functions ex machina</h1>
<p>Let‚Äôs spice our coding up a bit and write a few functions we can use to calculate samples sizes for different &amp;se_e$s.</p>
<p>Also, so far we‚Äôve been talking about <span class="math inline">\(se_e\)</span> or, in other words, the standard deviation of the of the posterior probability of the effect of interest.
If you remember your probability 101, you should know that the width of the 95% CrI of a posterior probability is 4 times the standard deviation.</p>
<p>So let‚Äôs write a function to calculate <span class="math inline">\(n_e\)</span> based on the <em>width</em> of the 95% CrI, rather than on the <span class="math inline">\(se_e\)</span>.</p>
<pre class="r"><code>estimate_n &lt;- function(obs_se, obs_n, width, divide = 1) {
  sigma &lt;- sqrt(obs_n) * obs_se
  se &lt;- width / 4
  new_n &lt;- (sigma / se)^2
  return(new_n / divide)
}</code></pre>
<p>Let‚Äôs take it for a spin, using the numbers from the example above.
The <span class="math inline">\(se_o\)</span> we observed was 10 Hz, that‚Äôs corresponds to a width of <span class="math inline">\(10 * 4 = 40\)</span> Hz.
(Note that the first argument is the <span class="math inline">\(se_o\)</span>, not the width, but you can change that for consistency if you wish).
The sample size <span class="math inline">\(n_o\)</span> was 150.
The <span class="math inline">\(se_e\)</span> we want was 5 Hz, so the width is <span class="math inline">\(5 * 4 = 20\)</span> Hz.</p>
<p>Let‚Äôs plug in these numbers.</p>
<pre class="r"><code>estimate_n(obs_se = 10, obs_n = 150, width = 20)</code></pre>
<pre><code>## [1] 600</code></pre>
<p>As we have already seen above, to get a 95% CrI width of 20 Hz, we would need at least 600 observations.</p>
<p>Now let‚Äôs define a few functions that calculate the required sample size at different widths and create a plot.</p>
<pre class="r"><code>get_obs_range &lt;- function(obs_se, obs_n, min_width = 1, max_width, by = 1, divide = 1) {
  obs_range &lt;- NULL
  for (i in seq(min_width, max_width, by = by)) {
    obs_range &lt;- c(obs_range, estimate_n(obs_se, obs_n, i, divide))
  }
  return(obs_range)
}

plot_obs_range &lt;- function(obs_se, obs_n, min_width = 1, max_width, by = 1, divide = 1) {
  obs_range &lt;- get_obs_range(obs_se, obs_n, min_width, max_width, by, divide)

  ggplot2::ggplot() +
    aes(x = seq(min_width, max_width, by = by), y = obs_range) +
    geom_point() +
    geom_path() +
    labs(
      caption = paste0(&quot;SE = &quot;, obs_se, &quot;, &quot;, obs_n, &quot; obs&quot;),
      x = &quot;CI width&quot;,
      y = paste0(&quot;Estimated N &quot;, &quot;(N/&quot;, divide, &quot;)&quot;)
    )
}</code></pre>
<p>Let‚Äôs now plot the required sample sizes to reach a 95% CrI width in the range from 10 to 50, by 5.</p>
<pre class="r"><code>plot_obs_range(10, 150, min_width = 10, max_width = 50, by = 5) +
  scale_y_continuous(breaks = seq(0, 3000, 250))</code></pre>
<p><img src="https://stefanocoretta.github.io/post/2022-04-05-bayesian-ci-width-power-analysis/index_files/figure-html/rr,%20eval-1.png" width="672" /></p>
</div>

</div>
  <footer class="post-footer">
  </footer>
</article>
    </main><footer class="footer">
    <span>&copy; 2023 <a href="https://stefanocoretta.github.io">Stefano Coretta</a></span>
    <span>&middot;</span>
    <span>Powered by <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a></span>
    <span>&middot;</span>
    <span>Theme <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>



<script defer src="/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js" integrity="sha256-uVus3DnjejMqn4g7Hni&#43;Srwf3KK8HyZB9V4809q9TWE="
    onload="hljs.initHighlightingOnLoad();"></script>
<script>
    window.onload = function () {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }

    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>

</body>

</html>
